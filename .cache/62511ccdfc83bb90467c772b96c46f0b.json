{"dependencies":[{"name":"/root/nos-client-new/latest-smartt-code/package.json","includedInParent":true,"mtime":1532420826470},{"name":"/root/nos-client-new/latest-smartt-code/node_modules/node-forge/package.json","includedInParent":true,"mtime":499162500000},{"name":"./forge","loc":{"line":9,"column":20}},{"name":"./aes","loc":{"line":10,"column":8}},{"name":"./tls","loc":{"line":11,"column":8}}],"generated":{"js":"var e=require(\"./forge\");require(\"./aes\"),require(\"./tls\");var t=module.exports=e.tls;function r(r,n,a){var c=n.entity===e.tls.ConnectionEnd.client;r.read.cipherState={init:!1,cipher:e.cipher.createDecipher(\"AES-CBC\",c?a.keys.server_write_key:a.keys.client_write_key),iv:c?a.keys.server_write_IV:a.keys.client_write_IV},r.write.cipherState={init:!1,cipher:e.cipher.createCipher(\"AES-CBC\",c?a.keys.client_write_key:a.keys.server_write_key),iv:c?a.keys.client_write_IV:a.keys.server_write_IV},r.read.cipherFunction=_,r.write.cipherFunction=i,r.read.macLength=r.write.macLength=a.mac_length,r.read.macFunction=r.write.macFunction=t.hmac_sha1}function i(r,i){var a,c=!1,_=i.macFunction(i.macKey,i.sequenceNumber,r);r.fragment.putBytes(_),i.updateSequenceNumber(),a=r.version.minor===t.Versions.TLS_1_0.minor?i.cipherState.init?null:i.cipherState.iv:e.random.getBytesSync(16),i.cipherState.init=!0;var h=i.cipherState.cipher;return h.start({iv:a}),r.version.minor>=t.Versions.TLS_1_1.minor&&h.output.putBytes(a),h.update(r.fragment),h.finish(n)&&(r.fragment=h.output,r.length=r.fragment.length(),c=!0),c}function n(e,t,r){if(!r){var i=e-t.length()%e;t.fillWithByte(i-1,i)}return!0}function a(e,t,r){var i=!0;if(r){for(var n=t.length(),a=t.last(),c=n-1-a;c<n-1;++c)i=i&&t.at(c)==a;i&&t.truncate(a+1)}return i}t.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:\"TLS_RSA_WITH_AES_128_CBC_SHA\",initSecurityParameters:function(e){e.bulk_cipher_algorithm=t.BulkCipherAlgorithm.aes,e.cipher_type=t.CipherType.block,e.enc_key_length=16,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=t.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:r},t.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:\"TLS_RSA_WITH_AES_256_CBC_SHA\",initSecurityParameters:function(e){e.bulk_cipher_algorithm=t.BulkCipherAlgorithm.aes,e.cipher_type=t.CipherType.block,e.enc_key_length=32,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=t.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:r};var c=0;function _(r,i){var n,_=!1;++c,n=r.version.minor===t.Versions.TLS_1_0.minor?i.cipherState.init?null:i.cipherState.iv:r.fragment.getBytes(16),i.cipherState.init=!0;var u=i.cipherState.cipher;u.start({iv:n}),u.update(r.fragment),_=u.finish(a);var o=i.macLength,l=e.random.getBytesSync(o),m=u.output.length();m>=o?(r.fragment=u.output.getBytes(m-o),l=u.output.getBytes(o)):r.fragment=u.output.getBytes(),r.fragment=e.util.createBuffer(r.fragment),r.length=r.fragment.length();var s=i.macFunction(i.macKey,i.sequenceNumber,r);return i.updateSequenceNumber(),_=h(i.macKey,l,s)&&_}function h(t,r,i){var n=e.hmac.create();return n.start(\"SHA1\",t),n.update(r),r=n.digest().getBytes(),n.start(null,null),n.update(i),r===(i=n.digest().getBytes())}","map":{"mappings":[{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":2,"column":0},"generated":{"line":2,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":3,"column":0},"generated":{"line":3,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":4,"column":0},"generated":{"line":4,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":5,"column":0},"generated":{"line":5,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":6,"column":0},"generated":{"line":6,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":7,"column":0},"generated":{"line":7,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":8,"column":0},"generated":{"line":8,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":9,"column":0},"generated":{"line":9,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":10,"column":0},"generated":{"line":10,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":11,"column":0},"generated":{"line":11,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":12,"column":0},"generated":{"line":12,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":13,"column":0},"generated":{"line":13,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":14,"column":0},"generated":{"line":14,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":15,"column":0},"generated":{"line":15,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":16,"column":0},"generated":{"line":16,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":17,"column":0},"generated":{"line":17,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":18,"column":0},"generated":{"line":18,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":19,"column":0},"generated":{"line":19,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":20,"column":0},"generated":{"line":20,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":21,"column":0},"generated":{"line":21,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":22,"column":0},"generated":{"line":22,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":23,"column":0},"generated":{"line":23,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":24,"column":0},"generated":{"line":24,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":25,"column":0},"generated":{"line":25,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":26,"column":0},"generated":{"line":26,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":27,"column":0},"generated":{"line":27,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":28,"column":0},"generated":{"line":28,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":29,"column":0},"generated":{"line":29,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":30,"column":0},"generated":{"line":30,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":31,"column":0},"generated":{"line":31,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":32,"column":0},"generated":{"line":32,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":33,"column":0},"generated":{"line":33,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":34,"column":0},"generated":{"line":34,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":35,"column":0},"generated":{"line":35,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":36,"column":0},"generated":{"line":36,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":37,"column":0},"generated":{"line":37,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":38,"column":0},"generated":{"line":38,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":39,"column":0},"generated":{"line":39,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":40,"column":0},"generated":{"line":40,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":41,"column":0},"generated":{"line":41,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":42,"column":0},"generated":{"line":42,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":43,"column":0},"generated":{"line":43,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":44,"column":0},"generated":{"line":44,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":45,"column":0},"generated":{"line":45,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":46,"column":0},"generated":{"line":46,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":47,"column":0},"generated":{"line":47,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":48,"column":0},"generated":{"line":48,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":49,"column":0},"generated":{"line":49,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":50,"column":0},"generated":{"line":50,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":51,"column":0},"generated":{"line":51,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":52,"column":0},"generated":{"line":52,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":53,"column":0},"generated":{"line":53,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":54,"column":0},"generated":{"line":54,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":55,"column":0},"generated":{"line":55,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":56,"column":0},"generated":{"line":56,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":57,"column":0},"generated":{"line":57,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":58,"column":0},"generated":{"line":58,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":59,"column":0},"generated":{"line":59,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":60,"column":0},"generated":{"line":60,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":61,"column":0},"generated":{"line":61,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":62,"column":0},"generated":{"line":62,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":63,"column":0},"generated":{"line":63,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":64,"column":0},"generated":{"line":64,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":65,"column":0},"generated":{"line":65,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":66,"column":0},"generated":{"line":66,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":67,"column":0},"generated":{"line":67,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":68,"column":0},"generated":{"line":68,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":69,"column":0},"generated":{"line":69,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":70,"column":0},"generated":{"line":70,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":71,"column":0},"generated":{"line":71,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":72,"column":0},"generated":{"line":72,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":73,"column":0},"generated":{"line":73,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":74,"column":0},"generated":{"line":74,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":75,"column":0},"generated":{"line":75,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":76,"column":0},"generated":{"line":76,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":77,"column":0},"generated":{"line":77,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":78,"column":0},"generated":{"line":78,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":79,"column":0},"generated":{"line":79,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":80,"column":0},"generated":{"line":80,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":81,"column":0},"generated":{"line":81,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":82,"column":0},"generated":{"line":82,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":83,"column":0},"generated":{"line":83,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":84,"column":0},"generated":{"line":84,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":85,"column":0},"generated":{"line":85,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":86,"column":0},"generated":{"line":86,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":87,"column":0},"generated":{"line":87,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":88,"column":0},"generated":{"line":88,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":89,"column":0},"generated":{"line":89,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":90,"column":0},"generated":{"line":90,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":91,"column":0},"generated":{"line":91,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":92,"column":0},"generated":{"line":92,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":93,"column":0},"generated":{"line":93,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":94,"column":0},"generated":{"line":94,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":95,"column":0},"generated":{"line":95,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":96,"column":0},"generated":{"line":96,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":97,"column":0},"generated":{"line":97,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":98,"column":0},"generated":{"line":98,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":99,"column":0},"generated":{"line":99,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":100,"column":0},"generated":{"line":100,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":101,"column":0},"generated":{"line":101,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":102,"column":0},"generated":{"line":102,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":103,"column":0},"generated":{"line":103,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":104,"column":0},"generated":{"line":104,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":105,"column":0},"generated":{"line":105,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":106,"column":0},"generated":{"line":106,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":107,"column":0},"generated":{"line":107,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":108,"column":0},"generated":{"line":108,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":109,"column":0},"generated":{"line":109,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":110,"column":0},"generated":{"line":110,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":111,"column":0},"generated":{"line":111,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":112,"column":0},"generated":{"line":112,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":113,"column":0},"generated":{"line":113,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":114,"column":0},"generated":{"line":114,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":115,"column":0},"generated":{"line":115,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":116,"column":0},"generated":{"line":116,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":117,"column":0},"generated":{"line":117,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":118,"column":0},"generated":{"line":118,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":119,"column":0},"generated":{"line":119,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":120,"column":0},"generated":{"line":120,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":121,"column":0},"generated":{"line":121,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":122,"column":0},"generated":{"line":122,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":123,"column":0},"generated":{"line":123,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":124,"column":0},"generated":{"line":124,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":125,"column":0},"generated":{"line":125,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":126,"column":0},"generated":{"line":126,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":127,"column":0},"generated":{"line":127,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":128,"column":0},"generated":{"line":128,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":129,"column":0},"generated":{"line":129,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":130,"column":0},"generated":{"line":130,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":131,"column":0},"generated":{"line":131,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":132,"column":0},"generated":{"line":132,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":133,"column":0},"generated":{"line":133,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":134,"column":0},"generated":{"line":134,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":135,"column":0},"generated":{"line":135,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":136,"column":0},"generated":{"line":136,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":137,"column":0},"generated":{"line":137,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":138,"column":0},"generated":{"line":138,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":139,"column":0},"generated":{"line":139,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":140,"column":0},"generated":{"line":140,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":141,"column":0},"generated":{"line":141,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":142,"column":0},"generated":{"line":142,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":143,"column":0},"generated":{"line":143,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":144,"column":0},"generated":{"line":144,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":145,"column":0},"generated":{"line":145,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":146,"column":0},"generated":{"line":146,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":147,"column":0},"generated":{"line":147,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":148,"column":0},"generated":{"line":148,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":149,"column":0},"generated":{"line":149,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":150,"column":0},"generated":{"line":150,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":151,"column":0},"generated":{"line":151,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":152,"column":0},"generated":{"line":152,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":153,"column":0},"generated":{"line":153,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":154,"column":0},"generated":{"line":154,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":155,"column":0},"generated":{"line":155,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":156,"column":0},"generated":{"line":156,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":157,"column":0},"generated":{"line":157,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":158,"column":0},"generated":{"line":158,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":159,"column":0},"generated":{"line":159,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":160,"column":0},"generated":{"line":160,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":161,"column":0},"generated":{"line":161,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":162,"column":0},"generated":{"line":162,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":163,"column":0},"generated":{"line":163,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":164,"column":0},"generated":{"line":164,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":165,"column":0},"generated":{"line":165,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":166,"column":0},"generated":{"line":166,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":167,"column":0},"generated":{"line":167,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":168,"column":0},"generated":{"line":168,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":169,"column":0},"generated":{"line":169,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":170,"column":0},"generated":{"line":170,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":171,"column":0},"generated":{"line":171,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":172,"column":0},"generated":{"line":172,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":173,"column":0},"generated":{"line":173,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":174,"column":0},"generated":{"line":174,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":175,"column":0},"generated":{"line":175,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":176,"column":0},"generated":{"line":176,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":177,"column":0},"generated":{"line":177,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":178,"column":0},"generated":{"line":178,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":179,"column":0},"generated":{"line":179,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":180,"column":0},"generated":{"line":180,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":181,"column":0},"generated":{"line":181,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":182,"column":0},"generated":{"line":182,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":183,"column":0},"generated":{"line":183,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":184,"column":0},"generated":{"line":184,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":185,"column":0},"generated":{"line":185,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":186,"column":0},"generated":{"line":186,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":187,"column":0},"generated":{"line":187,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":188,"column":0},"generated":{"line":188,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":189,"column":0},"generated":{"line":189,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":190,"column":0},"generated":{"line":190,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":191,"column":0},"generated":{"line":191,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":192,"column":0},"generated":{"line":192,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":193,"column":0},"generated":{"line":193,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":194,"column":0},"generated":{"line":194,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":195,"column":0},"generated":{"line":195,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":196,"column":0},"generated":{"line":196,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":197,"column":0},"generated":{"line":197,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":198,"column":0},"generated":{"line":198,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":199,"column":0},"generated":{"line":199,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":200,"column":0},"generated":{"line":200,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":201,"column":0},"generated":{"line":201,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":202,"column":0},"generated":{"line":202,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":203,"column":0},"generated":{"line":203,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":204,"column":0},"generated":{"line":204,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":205,"column":0},"generated":{"line":205,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":206,"column":0},"generated":{"line":206,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":207,"column":0},"generated":{"line":207,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":208,"column":0},"generated":{"line":208,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":209,"column":0},"generated":{"line":209,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":210,"column":0},"generated":{"line":210,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":211,"column":0},"generated":{"line":211,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":212,"column":0},"generated":{"line":212,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":213,"column":0},"generated":{"line":213,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":214,"column":0},"generated":{"line":214,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":215,"column":0},"generated":{"line":215,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":216,"column":0},"generated":{"line":216,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":217,"column":0},"generated":{"line":217,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":218,"column":0},"generated":{"line":218,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":219,"column":0},"generated":{"line":219,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":220,"column":0},"generated":{"line":220,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":221,"column":0},"generated":{"line":221,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":222,"column":0},"generated":{"line":222,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":223,"column":0},"generated":{"line":223,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":224,"column":0},"generated":{"line":224,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":225,"column":0},"generated":{"line":225,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":226,"column":0},"generated":{"line":226,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":227,"column":0},"generated":{"line":227,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":228,"column":0},"generated":{"line":228,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":229,"column":0},"generated":{"line":229,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":230,"column":0},"generated":{"line":230,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":231,"column":0},"generated":{"line":231,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":232,"column":0},"generated":{"line":232,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":233,"column":0},"generated":{"line":233,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":234,"column":0},"generated":{"line":234,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":235,"column":0},"generated":{"line":235,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":236,"column":0},"generated":{"line":236,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":237,"column":0},"generated":{"line":237,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":238,"column":0},"generated":{"line":238,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":239,"column":0},"generated":{"line":239,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":240,"column":0},"generated":{"line":240,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":241,"column":0},"generated":{"line":241,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":242,"column":0},"generated":{"line":242,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":243,"column":0},"generated":{"line":243,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":244,"column":0},"generated":{"line":244,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":245,"column":0},"generated":{"line":245,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":246,"column":0},"generated":{"line":246,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":247,"column":0},"generated":{"line":247,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":248,"column":0},"generated":{"line":248,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":249,"column":0},"generated":{"line":249,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":250,"column":0},"generated":{"line":250,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":251,"column":0},"generated":{"line":251,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":252,"column":0},"generated":{"line":252,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":253,"column":0},"generated":{"line":253,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":254,"column":0},"generated":{"line":254,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":255,"column":0},"generated":{"line":255,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":256,"column":0},"generated":{"line":256,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":257,"column":0},"generated":{"line":257,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":258,"column":0},"generated":{"line":258,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":259,"column":0},"generated":{"line":259,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":260,"column":0},"generated":{"line":260,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":261,"column":0},"generated":{"line":261,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":262,"column":0},"generated":{"line":262,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":263,"column":0},"generated":{"line":263,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":264,"column":0},"generated":{"line":264,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":265,"column":0},"generated":{"line":265,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":266,"column":0},"generated":{"line":266,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":267,"column":0},"generated":{"line":267,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":268,"column":0},"generated":{"line":268,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":269,"column":0},"generated":{"line":269,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":270,"column":0},"generated":{"line":270,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":271,"column":0},"generated":{"line":271,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":272,"column":0},"generated":{"line":272,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":273,"column":0},"generated":{"line":273,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":274,"column":0},"generated":{"line":274,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":275,"column":0},"generated":{"line":275,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":276,"column":0},"generated":{"line":276,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":277,"column":0},"generated":{"line":277,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":278,"column":0},"generated":{"line":278,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":279,"column":0},"generated":{"line":279,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":280,"column":0},"generated":{"line":280,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":281,"column":0},"generated":{"line":281,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":282,"column":0},"generated":{"line":282,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":283,"column":0},"generated":{"line":283,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":284,"column":0},"generated":{"line":284,"column":0}},{"source":"../node_modules/node-forge/lib/aesCipherSuites.js","original":{"line":285,"column":0},"generated":{"line":285,"column":0}}],"sources":{"../node_modules/node-forge/lib/aesCipherSuites.js":"/**\n * A Javascript implementation of AES Cipher Suites for TLS.\n *\n * @author Dave Longley\n *\n * Copyright (c) 2009-2015 Digital Bazaar, Inc.\n *\n */\nvar forge = require('./forge');\nrequire('./aes');\nrequire('./tls');\n\nvar tls = module.exports = forge.tls;\n\n/**\n * Supported cipher suites.\n */\ntls.CipherSuites['TLS_RSA_WITH_AES_128_CBC_SHA'] = {\n  id: [0x00,0x2f],\n  name: 'TLS_RSA_WITH_AES_128_CBC_SHA',\n  initSecurityParameters: function(sp) {\n    sp.bulk_cipher_algorithm = tls.BulkCipherAlgorithm.aes;\n    sp.cipher_type = tls.CipherType.block;\n    sp.enc_key_length = 16;\n    sp.block_length = 16;\n    sp.fixed_iv_length = 16;\n    sp.record_iv_length = 16;\n    sp.mac_algorithm = tls.MACAlgorithm.hmac_sha1;\n    sp.mac_length = 20;\n    sp.mac_key_length = 20;\n  },\n  initConnectionState: initConnectionState\n};\ntls.CipherSuites['TLS_RSA_WITH_AES_256_CBC_SHA'] = {\n  id: [0x00,0x35],\n  name: 'TLS_RSA_WITH_AES_256_CBC_SHA',\n  initSecurityParameters: function(sp) {\n    sp.bulk_cipher_algorithm = tls.BulkCipherAlgorithm.aes;\n    sp.cipher_type = tls.CipherType.block;\n    sp.enc_key_length = 32;\n    sp.block_length = 16;\n    sp.fixed_iv_length = 16;\n    sp.record_iv_length = 16;\n    sp.mac_algorithm = tls.MACAlgorithm.hmac_sha1;\n    sp.mac_length = 20;\n    sp.mac_key_length = 20;\n  },\n  initConnectionState: initConnectionState\n};\n\nfunction initConnectionState(state, c, sp) {\n  var client = (c.entity === forge.tls.ConnectionEnd.client);\n\n  // cipher setup\n  state.read.cipherState = {\n    init: false,\n    cipher: forge.cipher.createDecipher('AES-CBC', client ?\n      sp.keys.server_write_key : sp.keys.client_write_key),\n    iv: client ? sp.keys.server_write_IV : sp.keys.client_write_IV\n  };\n  state.write.cipherState = {\n    init: false,\n    cipher: forge.cipher.createCipher('AES-CBC', client ?\n      sp.keys.client_write_key : sp.keys.server_write_key),\n    iv: client ? sp.keys.client_write_IV : sp.keys.server_write_IV\n  };\n  state.read.cipherFunction = decrypt_aes_cbc_sha1;\n  state.write.cipherFunction = encrypt_aes_cbc_sha1;\n\n  // MAC setup\n  state.read.macLength = state.write.macLength = sp.mac_length;\n  state.read.macFunction = state.write.macFunction = tls.hmac_sha1;\n}\n\n/**\n * Encrypts the TLSCompressed record into a TLSCipherText record using AES\n * in CBC mode.\n *\n * @param record the TLSCompressed record to encrypt.\n * @param s the ConnectionState to use.\n *\n * @return true on success, false on failure.\n */\nfunction encrypt_aes_cbc_sha1(record, s) {\n  var rval = false;\n\n  // append MAC to fragment, update sequence number\n  var mac = s.macFunction(s.macKey, s.sequenceNumber, record);\n  record.fragment.putBytes(mac);\n  s.updateSequenceNumber();\n\n  // TLS 1.1+ use an explicit IV every time to protect against CBC attacks\n  var iv;\n  if(record.version.minor === tls.Versions.TLS_1_0.minor) {\n    // use the pre-generated IV when initializing for TLS 1.0, otherwise use\n    // the residue from the previous encryption\n    iv = s.cipherState.init ? null : s.cipherState.iv;\n  } else {\n    iv = forge.random.getBytesSync(16);\n  }\n\n  s.cipherState.init = true;\n\n  // start cipher\n  var cipher = s.cipherState.cipher;\n  cipher.start({iv: iv});\n\n  // TLS 1.1+ write IV into output\n  if(record.version.minor >= tls.Versions.TLS_1_1.minor) {\n    cipher.output.putBytes(iv);\n  }\n\n  // do encryption (default padding is appropriate)\n  cipher.update(record.fragment);\n  if(cipher.finish(encrypt_aes_cbc_sha1_padding)) {\n    // set record fragment to encrypted output\n    record.fragment = cipher.output;\n    record.length = record.fragment.length();\n    rval = true;\n  }\n\n  return rval;\n}\n\n/**\n * Handles padding for aes_cbc_sha1 in encrypt mode.\n *\n * @param blockSize the block size.\n * @param input the input buffer.\n * @param decrypt true in decrypt mode, false in encrypt mode.\n *\n * @return true on success, false on failure.\n */\nfunction encrypt_aes_cbc_sha1_padding(blockSize, input, decrypt) {\n  /* The encrypted data length (TLSCiphertext.length) is one more than the sum\n   of SecurityParameters.block_length, TLSCompressed.length,\n   SecurityParameters.mac_length, and padding_length.\n\n   The padding may be any length up to 255 bytes long, as long as it results in\n   the TLSCiphertext.length being an integral multiple of the block length.\n   Lengths longer than necessary might be desirable to frustrate attacks on a\n   protocol based on analysis of the lengths of exchanged messages. Each uint8\n   in the padding data vector must be filled with the padding length value.\n\n   The padding length should be such that the total size of the\n   GenericBlockCipher structure is a multiple of the cipher's block length.\n   Legal values range from zero to 255, inclusive. This length specifies the\n   length of the padding field exclusive of the padding_length field itself.\n\n   This is slightly different from PKCS#7 because the padding value is 1\n   less than the actual number of padding bytes if you include the\n   padding_length uint8 itself as a padding byte. */\n  if(!decrypt) {\n    // get the number of padding bytes required to reach the blockSize and\n    // subtract 1 for the padding value (to make room for the padding_length\n    // uint8)\n    var padding = blockSize - (input.length() % blockSize);\n    input.fillWithByte(padding - 1, padding);\n  }\n  return true;\n}\n\n/**\n * Handles padding for aes_cbc_sha1 in decrypt mode.\n *\n * @param blockSize the block size.\n * @param output the output buffer.\n * @param decrypt true in decrypt mode, false in encrypt mode.\n *\n * @return true on success, false on failure.\n */\nfunction decrypt_aes_cbc_sha1_padding(blockSize, output, decrypt) {\n  var rval = true;\n  if(decrypt) {\n    /* The last byte in the output specifies the number of padding bytes not\n      including itself. Each of the padding bytes has the same value as that\n      last byte (known as the padding_length). Here we check all padding\n      bytes to ensure they have the value of padding_length even if one of\n      them is bad in order to ward-off timing attacks. */\n    var len = output.length();\n    var paddingLength = output.last();\n    for(var i = len - 1 - paddingLength; i < len - 1; ++i) {\n      rval = rval && (output.at(i) == paddingLength);\n    }\n    if(rval) {\n      // trim off padding bytes and last padding length byte\n      output.truncate(paddingLength + 1);\n    }\n  }\n  return rval;\n}\n\n/**\n * Decrypts a TLSCipherText record into a TLSCompressed record using\n * AES in CBC mode.\n *\n * @param record the TLSCipherText record to decrypt.\n * @param s the ConnectionState to use.\n *\n * @return true on success, false on failure.\n */\nvar count = 0;\nfunction decrypt_aes_cbc_sha1(record, s) {\n  var rval = false;\n  ++count;\n\n  var iv;\n  if(record.version.minor === tls.Versions.TLS_1_0.minor) {\n    // use pre-generated IV when initializing for TLS 1.0, otherwise use the\n    // residue from the previous decryption\n    iv = s.cipherState.init ? null : s.cipherState.iv;\n  } else {\n    // TLS 1.1+ use an explicit IV every time to protect against CBC attacks\n    // that is appended to the record fragment\n    iv = record.fragment.getBytes(16);\n  }\n\n  s.cipherState.init = true;\n\n  // start cipher\n  var cipher = s.cipherState.cipher;\n  cipher.start({iv: iv});\n\n  // do decryption\n  cipher.update(record.fragment);\n  rval = cipher.finish(decrypt_aes_cbc_sha1_padding);\n\n  // even if decryption fails, keep going to minimize timing attacks\n\n  // decrypted data:\n  // first (len - 20) bytes = application data\n  // last 20 bytes          = MAC\n  var macLen = s.macLength;\n\n  // create a random MAC to check against should the mac length check fail\n  // Note: do this regardless of the failure to keep timing consistent\n  var mac = forge.random.getBytesSync(macLen);\n\n  // get fragment and mac\n  var len = cipher.output.length();\n  if(len >= macLen) {\n    record.fragment = cipher.output.getBytes(len - macLen);\n    mac = cipher.output.getBytes(macLen);\n  } else {\n    // bad data, but get bytes anyway to try to keep timing consistent\n    record.fragment = cipher.output.getBytes();\n  }\n  record.fragment = forge.util.createBuffer(record.fragment);\n  record.length = record.fragment.length();\n\n  // see if data integrity checks out, update sequence number\n  var mac2 = s.macFunction(s.macKey, s.sequenceNumber, record);\n  s.updateSequenceNumber();\n  rval = compareMacs(s.macKey, mac, mac2) && rval;\n  return rval;\n}\n\n/**\n * Safely compare two MACs. This function will compare two MACs in a way\n * that protects against timing attacks.\n *\n * TODO: Expose elsewhere as a utility API.\n *\n * See: https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2011/february/double-hmac-verification/\n *\n * @param key the MAC key to use.\n * @param mac1 as a binary-encoded string of bytes.\n * @param mac2 as a binary-encoded string of bytes.\n *\n * @return true if the MACs are the same, false if not.\n */\nfunction compareMacs(key, mac1, mac2) {\n  var hmac = forge.hmac.create();\n\n  hmac.start('SHA1', key);\n  hmac.update(mac1);\n  mac1 = hmac.digest().getBytes();\n\n  hmac.start(null, null);\n  hmac.update(mac2);\n  mac2 = hmac.digest().getBytes();\n\n  return mac1 === mac2;\n}\n"},"lineCount":285}},"hash":"df3eab446eb99f2d1754c62a1d35c3a7","cacheData":{"env":{}}}